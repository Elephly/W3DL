var W3DL={};const DEBUG=!0,NODE_MODULE=!1;let colorFragmentShaderText='#version 400",\n\nvarying vec4 vColor;\n\nvoid main(void)\n{\n  gl_FragColor = vColor;\n}',colorVertexShaderText="#version 400\n\nuniform mat4 transform;\nuniform mat4 view;\nuniform mat4 projection;\n\nlayout(location = 0) attribute vec4 vtxPosition;\nlayout(location = 1) attribute vec4 vtxNormal;\nlayout(location = 2) attribute vec4 vtxColor;\nlayout(location = 3) attribute vec2 vtxTextureCoord;\n\nvarying vec4 vColor;\n\nvoid main(void)\n\n{\n  gl_Position = projection * view * transform * vtxPosition;\n  vColor = vtxColor;\n}",gouraudFragmentShaderText="#version 400\n\nvarying vec4 vColor;\n\nvoid main(void)\n{\n  gl_FragColor = vColor;\n}",gouraudVertexShaderText="#version 400\n\nuniform mat4 transform;\nuniform mat4 view;\nuniform mat4 projection;\nuniform vec4 lightPosition;\n\nuniform vec4 lightColor;\nuniform vec4 ambient;\nuniform vec4 diffuse;\nuniform vec4 specular;\nuniform float shine;\n\nlayout(location = 0) attribute vec4 vtxPosition;\nlayout(location = 1) attribute vec4 vtxNormal;\nlayout(location = 2) attribute vec4 vtxColor;\nlayout(location = 3) attribute vec2 vtxTextureCoord;\n\nvarying vec4 vColor;\n\nvec4 threeTermReflectionLighting(vec3 normal, vec3 position, vec3 lightPos, float shininess,\n  vec4 ambientFraction, vec4 diffuseFraction, vec4 specularFraction, vec4 objectColor, vec4 lightCol)\n{\n  vec3 N = normalize(normal);\n  vec3 V = normalize(-position);\n  vec3 L = normalize(lightPos - position);\n  vec3 R = normalize(-L + 2 * (dot(L, N)) * N);\n\n  float diffuseIntensity = max(dot(N, L), 0.0);\n\n    float specularAngleCosine = max(dot(V, R), 0.0);\n  float specularIntensity = pow(specularAngleCosine, shininess);\n\n  vec4 ambi = ambientFraction * lightCol;\n  vec4 diff = diffuseIntensity * diffuseFraction * lightCol;\n  vec4 spec = specularIntensity * specularFraction * lightCol;\n\n  return (objectColor * (ambi + diff)) + spec;\n}\n\nvec4 threeTermHalfwayLighting(vec3 normal, vec3 position, vec3 lightPos, float shininess,\n  vec4 ambientFraction, vec4 diffuseFraction, vec4 specularFraction, vec4 objectColor, vec4 lightCol)\n{\n  vec3 N = normalize(normal);\n  vec3 V = normalize(-position);\n  vec3 L = normalize(lightPos - position);\n  vec3 H = normalize(V + L);\n\n  float diffuseIntensity = max(dot(N, L), 0.0);\n\n    float specularAngleCosine = max(dot(N, H), 0.0);\n  float specularIntensity = pow(specularAngleCosine, shininess);\n\n  vec4 ambi = ambientFraction * lightCol;\n  vec4 diff = diffuseIntensity * diffuseFraction * lightCol;\n  vec4 spec = specularIntensity * specularFraction * lightCol;\n\n  return (objectColor * (ambi + diff)) + spec;\n}\n\nvoid main(void)\n\n{\n  gl_Position = projection * view * transform * vtxPosition;\n\n  vec3 vPosition = vec3(view * transform * vtxPosition);\n  vec3 vNormal = vec3(transpose(inverse(view * transform)) * vtxNormal);\n  vec3 light = vec3(view * lightPosition);\n\n  vColor = threeTermHalfwayLighting(vNormal, vPosition, light, shine, ambient, diffuse, specular, vtxColor, lightColor);\n}",phongFragmentShaderText="#version 400\n\nuniform vec4 lightColor;\nuniform sampler2D textureSampler;\nuniform vec4 ambient;\nuniform vec4 diffuse;\nuniform vec4 specular;\nuniform float shine;\nuniform float toon;\nuniform float hasTexture;\n\nvarying vec3 vPosition;\nvarying vec3 vNormal;\nvarying vec4 vColor;\nvarying vec2 vTextureCoord;\nvarying vec3 light;\n\nvec4 threeTermReflectionLighting(vec3 normal, vec3 position, vec3 lightPos, float shininess,\n  vec4 ambientFraction, vec4 diffuseFraction, vec4 specularFraction, vec4 objectColor, vec4 lightCol)\n{\n  vec3 N = normalize(normal);\n  vec3 V = normalize(-position);\n  vec3 L = normalize(lightPos - position);\n  vec3 R = normalize(-L + 2 * (dot(L, N)) * N);\n\n  float diffuseIntensity = max(dot(N, L), 0.0);\n\n    float specularAngleCosine = max(dot(V, R), 0.0);\n  float specularIntensity = pow(specularAngleCosine, shininess);\n\n  vec4 ambi = ambientFraction * lightCol;\n  vec4 diff = diffuseIntensity * diffuseFraction * lightCol;\n  vec4 spec = specularIntensity * specularFraction * lightCol;\n\n  return (objectColor * (ambi + diff)) + spec;\n}\n\nvec4 threeTermHalfwayLighting(vec3 normal, vec3 position, vec3 lightPos, float shininess,\n  vec4 ambientFraction, vec4 diffuseFraction, vec4 specularFraction, vec4 objectColor, vec4 lightCol)\n{\n  vec3 N = normalize(normal);\n  vec3 V = normalize(-position);\n  vec3 L = normalize(lightPos - position);\n  vec3 H = normalize(V + L);\n\n  float diffuseIntensity = max(dot(N, L), 0.0);\n\n    float specularAngleCosine = max(dot(N, H), 0.0);\n  float specularIntensity = pow(specularAngleCosine, shininess);\n\n  vec4 ambi = ambientFraction * lightCol;\n  vec4 diff = diffuseIntensity * diffuseFraction * lightCol;\n  vec4 spec = specularIntensity * specularFraction * lightCol;\n\n  return (objectColor * (ambi + diff)) + spec;\n}\n\nvec4 toonify(vec3 normal, vec3 position, vec4 color)\n{\n  vec3 N = normalize(normal);\n  vec3 V = normalize(-vPosition);\n  vec4 C = color;\n\n  float angleBetweenViewerAndNormal = dot(V, N);\n  if (angleBetweenViewerAndNormal < cos(radians(70)))\n  {\n    C = vec4(0.0, 0.0, 0.0, 1.0);\n  }\n  else\n  {\n    float toonShades = 3.0;\n    C.r = max(ambient.r * C.r, C.r - (mod(C.r, 1.0 / toonShades)));\n    C.g = max(ambient.g * C.r, C.g - (mod(C.g, 1.0 / toonShades)));\n    C.b = max(ambient.b * C.r, C.b - (mod(C.b, 1.0 / toonShades)));\n    C.a = max(ambient.a * C.r, C.a - (mod(C.a, 1.0 / toonShades)));\n  }\n\n  return C;\n}\n\nvoid main(void)\n{\n  vec4 fragColor = vec4(1.0, 1.0, 1.0, 1.0);\n\n  if (hasTexture > 0.5)\n  {\n    fragColor = texture2D(textureSampler, vTextureCoord);\n  }\n\n  fragColor = threeTermHalfwayLighting(vNormal, vPosition, light, shine, ambient, diffuse, specular, fragColor, lightColor);\n\n  if (toon > 0.5)\n  {\n    fragColor = toonify(vNormal, vPosition, fragColor);\n  }\n\n    gl_FragColor = fragColor;\n}",phongVertexShaderText="#version 400\n\nuniform mat4 transform;\nuniform mat4 view;\nuniform mat4 projection;\nuniform vec4 lightPosition;\n\nlayout(location = 0) attribute vec4 vtxPosition;\nlayout(location = 1) attribute vec4 vtxNormal;\nlayout(location = 2) attribute vec4 vtxColor;\nlayout(location = 3) attribute vec2 vtxTextureCoord;\n\nvarying vec3 vPosition;\nvarying vec3 vNormal;\nvarying vec4 vColor;\nvarying vec2 vTextureCoord;\nvarying vec3 light;\n\nvoid main(void)\n{\n  gl_Position = projection * view * transform * vtxPosition;\n  vPosition = vec3(view * transform * vtxPosition);\n  vNormal = vec3(transpose(inverse(view * transform)) * vtxNormal);\n  vColor = vtxColor;\n  vTextureCoord = vtxTextureCoord;\n  light = vec3(view * lightPosition);\n}",textureFragmentShaderText="precision mediump float;\n\nvarying vec2 fragTexCoord;\nuniform sampler2D sampler;\n\nvoid main()\n{\n  gl_FragColor = texture2D(sampler, fragTexCoord);\n}",textureVertexShaderText="precision mediump float;\n\nuniform mat4 mWorld;\nuniform mat4 mView;\nuniform mat4 mProj;\n\nattribute vec3 vertPosition;\nattribute vec3 vertColor;\nattribute vec2 vertTexCoord;\n\nvarying vec2 fragTexCoord;\n\nvoid main()\n{\n  gl_Position = mProj * mView * mWorld * vec4(vertPosition, 1.0);\n  fragTexCoord = vertTexCoord;\n}",whiteVertexShaderText="#version 400\n\nuniform mat4 transform;\nuniform mat4 view;\nuniform mat4 projection;\n\nlayout(location = 0) attribute vec4 vtxPosition;\nlayout(location = 1) attribute vec4 vtxNormal;\nlayout(location = 2) attribute vec4 vtxColor;\nlayout(location = 3) attribute vec2 vtxTextureCoord;\n\nvarying vec4 vColor;\n\nvoid main(void)\n\n{\n  gl_Position = projection * view * transform * vtxPosition;\n  vColor = vec4(1.0, 1.0, 1.0, 1.0);\n}";W3DL.Utils={CheckArgAgainstType:function(t,e){if("function"!=typeof t)throw new TypeError("Cannot check parameter against invalid type: "+typeof t);switch(typeof e){case"array":case"function":case"object":return e instanceof t;default:return e.constructor.name===t.name}},ValidateArguments:function(t,e,r=t.length){if(!(t instanceof Array&&e instanceof Object&&"number"==typeof r))throw new Error("Failure to provide valid parameters to ValidateArguments: types("+t+"), args("+e+"), requiredArgCount("+r+")");if(t.length<r)throw new Error("Failure to provide enough types to check all required parameters: "+r+" required but only "+t.length+" given");if(e.length<r)throw new Error("Failure to provide all required parameters:  "+r+" required but only "+e.length+" given");for(var i=0;i<Math.min(t.length,e.length);i++)if(t[i]instanceof Array){if(!t[i].find(function(t){return W3DL.Utils.CheckArgAgainstType(t,this)},e[i])){var n=t[i].map(function(t){return t.name});throw new TypeError("Invalid parameter "+i+": expected one of ["+n+"] but got "+e[i].constructor.name)}}else if(!W3DL.Utils.CheckArgAgainstType(t[i],e[i]))throw new TypeError("Invalid parameter "+i+": expected "+t[i].name+" but got "+e[i].constructor.name)}},W3DL.Application=class{constructor(t){if(W3DL.Utils.ValidateArguments([HTMLCanvasElement],arguments),new.target===W3DL.Application)throw new TypeError("Cannot construct instances of abstract class: "+new.target.name);if(this.gl=t.getContext("webgl"),this.gl||(console.warn("webgl not supported. Falling back on experimental-webgl."),this.gl=t.getContext("experimental-webgl")),!this.gl)throw alert("Your browser does not support WebGL."),new Error("Browser does not support WebGL.");this.isInitialized=!1,this.lastUpdateTime=0,this.dispatchInitialize(),this.dispatchUpdate(!0),this.dispatchDraw(!0)}dispatchInitialize(){setTimeout(function(t){t.initialize&&t.initialize(),t.isInitialized=!0},0,this)}dispatchUpdate(t){W3DL.Utils.ValidateArguments([Boolean],arguments,0);let e=this.lastUpdateTime;this.lastUpdateTime=performance.now(),this.isInitialized&&this.update&&!t&&this.update(this.lastUpdateTime-e),setTimeout(function(t){t.dispatchUpdate()},16,this)}dispatchDraw(t){W3DL.Utils.ValidateArguments([Boolean],arguments,0),this.isInitialized&&this.draw&&!t&&this.draw(),requestAnimationFrame(function(t){return function(){t.dispatchDraw()}}(this))}},W3DL.Math={DegreeToRadian:function(t){return W3DL.Utils.ValidateArguments([Number],arguments),t*Math.PI/180},RadianToDegree:function(t){return W3DL.Utils.ValidateArguments([Number],arguments),180*t/Math.PI},Lerp:function(t,e,r){return W3DL.Utils.ValidateArguments([Number,Number,Number],arguments),(r>1||r<0)&&(r-=Math.floor(r)),(1-r)*t+r*e}},W3DL.ColorRGBA=class{constructor(t=0,e=0,r=0,i=1){W3DL.Utils.ValidateArguments([Number,Number,Number,Number],arguments,0),this.red=t,this.green=e,this.blue=r,this.alpha=i}get toArray(){return[this.red,this.green,this.blue,this.alpha]}get toFloat32Array(){return new Float32Array(this.toArray)}get toVector3D(){return new W3DL.Vector3D(this.red,this.green,this.blue)}get toVector4D(){return new W3DL.Vector4D(this.red,this.green,this.blue,this.alpha)}},W3DL.Colors=class{constructor(){if(new.target===W3DL.Colors)throw new TypeError("Cannot construct instances of abstract class: "+new.target.name)}static get Black(){return this.__black=this.__black||new W3DL.ColorRGBA(0,0,0,1),this.__black}static get Blue(){return this.__blue=this.__blue||new W3DL.ColorRGBA(0,0,1,1),this.__blue}static get CornflowerBlue(){return this.__cornflowerBlue=this.__cornflowerBlue||new W3DL.ColorRGBA(100/255,149/255,237/255,1),this.__cornflowerBlue}static get Cyan(){return this.__cyan=this.__cyan||new W3DL.ColorRGBA(0,1,1,1),this.__cyan}static get Green(){return this.__green=this.__green||new W3DL.ColorRGBA(0,1,0,1),this.__green}static get Magenta(){return this.__magenta=this.__magenta||new W3DL.ColorRGBA(1,0,1,1),this.__magenta}static get Red(){return this.__red=this.__red||new W3DL.ColorRGBA(1,0,0,1),this.__red}static get White(){return this.__white=this.__white||new W3DL.ColorRGBA(1,1,1,1),this.__white}static get Yellow(){return this.__yellow=this.__yellow||new W3DL.ColorRGBA(1,1,0,1),this.__yellow}},W3DL.Vector=class{constructor(){if(new.target===W3DL.Vector)throw new TypeError("Cannot construct instances of abstract class: "+new.target.name);if(void 0===this.length||"number"!=typeof this.length)throw new TypeError("Override required for method: length");if(void 0===this.dot||"function"!=typeof this.dot)throw new TypeError("Override required for method: dot");if(void 0===this.negative||"function"!=typeof this.negative)throw new TypeError("Override required for method: negative");if(void 0===this.add||"function"!=typeof this.add)throw new TypeError("Override required for method: add");if(void 0===this.subtract||"function"!=typeof this.subtract)throw new TypeError("Override required for method: subtract");if(void 0===this.multiply||"function"!=typeof this.multiply)throw new TypeError("Override required for method: multiply");if(void 0===this.divide||"function"!=typeof this.divide)throw new TypeError("Override required for method: divide");if(void 0===this.toArray||"object"!=typeof this.toArray)throw new TypeError("Override required for method: toArray")}get normalized(){var t=this.length;return 0===t?0:this.divide(t)}get toFloat32Array(){return new Float32Array(this.toArray)}},W3DL.Vector2D=class extends W3DL.Vector{constructor(t=0,e=0){W3DL.Utils.ValidateArguments([Number,Number],arguments,0),super(),this.x=t,this.y=e}get length(){return Math.sqrt(this.x*this.x+this.y*this.y)}dot(t){return W3DL.Utils.ValidateArguments([this.constructor],arguments),this.x*t.x+this.y*t.y}negative(){return new W3DL.Vector2D(-this.x,-this.y)}add(t){return W3DL.Utils.ValidateArguments([this.constructor],arguments),new W3DL.Vector2D(this.x+t.x,this.y+t.y)}subtract(t){return W3DL.Utils.ValidateArguments([this.constructor],arguments),new W3DL.Vector2D(this.x-t.x,this.y-t.y)}multiply(t){return W3DL.Utils.ValidateArguments([Number],arguments),new W3DL.Vector2D(this.x*t,this.y*t)}divide(t){return W3DL.Utils.ValidateArguments([Number],arguments),new W3DL.Vector2D(this.x/t,this.y/t)}get toArray(){return[this.x,this.y]}},W3DL.Vector3D=class extends W3DL.Vector{constructor(t=0,e=0,r=0){W3DL.Utils.ValidateArguments([Number,Number,Number],arguments,0),super(),this.x=t,this.y=e,this.z=r}get length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}dot(t){return W3DL.Utils.ValidateArguments([this.constructor],arguments),this.x*t.x+this.y*t.y+this.z*t.z}cross(t){return W3DL.Utils.ValidateArguments([[W3DL.Vector3D,W3DL.Vector4D]],arguments),new W3DL.Vector3D(this.y*t.z-this.z*t.y,-(this.x*t.z-this.z*t.x),this.x*t.y-this.y*t.x)}negative(){return new W3DL.Vector3D(-this.x,-this.y,-this.z)}add(t){return W3DL.Utils.ValidateArguments([this.constructor],arguments),new W3DL.Vector3D(this.x+t.x,this.y+t.y,this.z+t.z)}subtract(t){return W3DL.Utils.ValidateArguments([this.constructor],arguments),new W3DL.Vector3D(this.x-t.x,this.y-t.y,this.z-t.z)}multiply(t){return W3DL.Utils.ValidateArguments([Number],arguments),new W3DL.Vector3D(this.x*t,this.y*t,this.z*t)}divide(t){return W3DL.Utils.ValidateArguments([Number],arguments),new W3DL.Vector3D(this.x/t,this.y/t,this.z/t)}get toArray(){return[this.x,this.y,this.z]}},W3DL.Vector4D=class extends W3DL.Vector{constructor(t=0,e=0,r=0,i=1){W3DL.Utils.ValidateArguments([Number,Number,Number,Number],arguments,0),super(),this.x=t,this.y=e,this.z=r,this.w=i}get length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}dot(t){return W3DL.Utils.ValidateArguments([this.constructor],arguments),this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w}dot3(t){return W3DL.Utils.ValidateArguments([[W3DL.Vector3D,W3DL.Vector4D]],arguments),this.x*t.x+this.y*t.y+this.z*t.z}cross(t){return W3DL.Utils.ValidateArguments([[W3DL.Vector3D,W3DL.Vector4D]],arguments),new W3DL.Vector4D(this.y*t.z-this.z*t.y,-(this.x*t.z-this.z*t.x),this.x*t.y-this.y*t.x)}negative(){return new W3DL.Vector4D(-this.x,-this.y,-this.z,-this.w)}add(t){return W3DL.Utils.ValidateArguments([this.constructor],arguments),new W3DL.Vector4D(this.x+t.x,this.y+t.y,this.z+t.z,this.w+t.w)}subtract(t){return W3DL.Utils.ValidateArguments([this.constructor],arguments),new W3DL.Vector4D(this.x-t.x,this.y-t.y,this.z-t.z,this.w-t.w)}multiply(t){return W3DL.Utils.ValidateArguments([Number],arguments),new W3DL.Vector4D(this.x*t,this.y*t,this.z*t,this.w*t)}divide(t){return W3DL.Utils.ValidateArguments([Number],arguments),new W3DL.Vector4D(this.x/t,this.y/t,this.z/t,this.w/t)}get toArray(){return[this.x,this.y,this.z,this.w]}},W3DL.Matrix=class{constructor(){if(new.target===W3DL.Matrix)throw new TypeError("Cannot construct instances of abstract class: "+new.target.name);if(void 0===this.matrixMultiply||"function"!=typeof this.matrixMultiply)throw new TypeError("Override required for method: matrixMultiply");if(void 0===this.vectorMultiply||"function"!=typeof this.vectorMultiply)throw new TypeError("Override required for method: vectorMultiply");this.entries=null}static Null(){return new this}static Zero(){var t=new this,e=t.entries.length,r=t.entries[e-1].length;return t.entries[e-1][r-1]=1,t}static Identity(){for(var t=new this,e=0;e<t.entries.length&&(void 0!==t.entries[e]&&void 0!==t.entries[e][e]);e++)t.entries[e][e]=1;return t}nullify(){for(var t=0;t<this.entries.length;t++)for(var e=0;e<this.entries[t].length;e++)this.entries[t][e]=0}transposed(){for(var t=new this.constructor,e=0;e<this.entries.length;e++)for(var r=0;r<this.entries[e].length;r++)void 0!==t.entries[r][e]&&(t.entries[r][e]=this.entries[e][r]);return t}add(t){W3DL.Utils.ValidateArguments([this.constructor],arguments);for(var e=new this.constructor,r=0;r<e.entries.length;r++)for(var i=0;i<e.entries[r].length;i++)e.entries[r][i]=this.entries[r][i]+t.entries[r][i];return e}subtract(t){W3DL.Utils.ValidateArguments([this.constructor],arguments);for(var e=new this.constructor,r=0;r<e.entries.length;r++)for(var i=0;i<e.entries[r].length;i++)e.entries[r][i]=this.entries[r][i]-t.entries[r][i];return e}multiply(t){W3DL.Utils.ValidateArguments([[Number,W3DL.Matrix,W3DL.Vector]],arguments);var e=null;if(new t.constructor instanceof Number){e=new this.constructor;for(var r=0;r<this.entries.length;r++)for(var i=0;i<this.entries[r].length;i++)e.entries[r][i]=this.entries[r][i]*t}else t instanceof W3DL.Matrix?e=this.matrixMultiply(t):t instanceof W3DL.Vector&&(e=this.vectorMultiply(t));return e}toString(){var t="";return this.entries.forEach(function(e,r,i){t+=e.toString(),r<i.length-1&&(t+="\n")}),t}get toArray(){let t=[];for(let e=0;e<this.entries[0].length;e++)for(let r=0;r<this.entries.length;r++)t.push(this.entries[r][e]);return t}get toFloat32Array(){return new Float32Array(this.toArray)}},W3DL.Matrix4=class extends W3DL.Matrix{constructor(t=new W3DL.Vector4D(0,0,0,0),e=new W3DL.Vector4D(0,0,0,0),r=new W3DL.Vector4D(0,0,0,0),i=new W3DL.Vector4D(0,0,0,0)){W3DL.Utils.ValidateArguments([W3DL.Vector4D,W3DL.Vector4D,W3DL.Vector4D,W3DL.Vector4D],arguments,0),super(),this.entries=[t.toArray,e.toArray,r.toArray,i.toArray]}static RotationAboutX(t,e=!0){W3DL.Utils.ValidateArguments([Number,Boolean],arguments,1);var r=e?W3DL.Math.DegreeToRadian(t):t,i=W3DL.Matrix4.Identity();return i.entries[1][1]=i.entries[2][2]=Math.cos(r),i.entries[1][2]=-(i.entries[2][1]=Math.sin(r)),i}static RotationAboutY(t,e=!0){W3DL.Utils.ValidateArguments([Number,Boolean],arguments,1);var r=e?W3DL.Math.DegreeToRadian(t):t,i=W3DL.Matrix4.Identity();return i.entries[0][0]=i.entries[2][2]=Math.cos(r),i.entries[0][2]=-(i.entries[2][0]=-Math.sin(r)),i}static RotationAboutZ(t,e=!0){W3DL.Utils.ValidateArguments([Number,Boolean],arguments,1);var r=e?W3DL.Math.DegreeToRadian(t):t,i=W3DL.Matrix4.Identity();return i.entries[0][0]=i.entries[1][1]=Math.cos(r),i.entries[0][1]=-(i.entries[1][0]=Math.sin(r)),i}static RollPitchYawRotation(t,e,r,i=!0){return W3DL.Utils.ValidateArguments([Number,Number,Number,Boolean],arguments,3),this.RotationAboutY(r,i).matrixMultiply(this.RotationAboutX(e,i)).matrixMultiply(this.RotationAboutZ(t,i))}static RotationAboutVectorAxis(t,e,r=!0){W3DL.Utils.ValidateArguments([[W3DL.Vector3D,W3DL.Vector4D],Number,Boolean],arguments,2);var i=r?W3DL.Math.DegreeToRadian(e):e,n=t.normalized(),o=n.x,a=n.y,s=n.z,l=Math.cos(i),c=Math.sin(i);return new W3DL.Matrix4(new W3DL.Vector4D(l+o*o*(1-l),o*a*(1-l)-s*c,o*s*(1-l)+a*c,0),new W3DL.Vector4D(o*a*(1-l)+s*c,l+a*a*(1-l),a*s*(1-l)-o*c,0),new W3DL.Vector4D(s*o*(1-l)-a*c,s*a*(1-l)+o*c,l+s*s*(1-l),0),new W3DL.Vector4D)}static Scale(t,e,r){return W3DL.Utils.ValidateArguments([Number,Number,Number],arguments),new W3DL.Matrix4(new W3DL.Vector4D(t,0,0,0),new W3DL.Vector4D(0,e,0,0),new W3DL.Vector4D(0,0,r,0),new W3DL.Vector4D)}static Translation(t,e,r){return W3DL.Utils.ValidateArguments([Number,Number,Number],arguments),new W3DL.Matrix4(new W3DL.Vector4D(1,0,0,t),new W3DL.Vector4D(0,1,0,e),new W3DL.Vector4D(0,0,1,r),new W3DL.Vector4D)}static TranslationFromVector(t){return W3DL.Utils.ValidateArguments([[W3DL.Vector3D,W3DL.Vector4D]],arguments),W3DL.Matrix4.Translation(t.x,t.y,t.z)}static Camera(t,e,r){W3DL.Utils.ValidateArguments([[W3DL.Vector3D,W3DL.Vector4D],[W3DL.Vector3D,W3DL.Vector4D],[W3DL.Vector3D,W3DL.Vector4D]],arguments);var i=t instanceof W3DL.Vector3D?t:new W3DL.Vector3D(t.x,t.y,t.z),n=e instanceof W3DL.Vector3D?e:new W3DL.Vector3D(e.x,e.y,e.z),o=r instanceof W3DL.Vector3D?r:new W3DL.Vector3D(r.x,r.y,r.z),a=i.subtract(n).normalized,s=o.normalized.cross(a).normalized,l=a.cross(s),c=new W3DL.Matrix4(new W3DL.Vector4D(s.x,s.y,s.z),new W3DL.Vector4D(l.x,l.y,l.z),new W3DL.Vector4D(a.x,a.y,a.z),new W3DL.Vector4D);return c.entries[0][3]=s.negative().dot(i),c.entries[1][3]=l.negative().dot(i),c.entries[2][3]=a.negative().dot(i),c}static FrustumProjetion(t,e,r,i,n,o){throw W3DL.Utils.ValidateArguments([Number,Number,Number,Number,Number,Number],arguments),new Error("Unimplemented.")}static SymmetricPerspectiveProjection(t,e,r,i){W3DL.Utils.ValidateArguments([Number,Number,Number,Number],arguments);var n=W3DL.Matrix4.Identity(),o=1/Math.tan(W3DL.Math.DegreeToRadian(t/2));return n.entries[0][0]=o/e,n.entries[1][1]=o,n.entries[2][2]=(r+i)/(r-i),n.entries[2][3]=2*r*i/(r-i),n.entries[3][2]=-1,n.entries[3][3]=0,n}matrixMultiply(t){W3DL.Utils.ValidateArguments([W3DL.Matrix4],arguments);for(var e=new W3DL.Matrix4,r=t.transposed(),i=0;i<4;i++)for(var n=new W3DL.Vector4D(this.entries[i][0],this.entries[i][1],this.entries[i][2],this.entries[i][3]),o=0;o<4;o++){var a=new W3DL.Vector4D(r.entries[o][0],r.entries[o][1],r.entries[o][2],r.entries[o][3]);e.entries[i][o]=n.dot(a)}return e}vectorMultiply(t){W3DL.Utils.ValidateArguments([W3DL.Vector4D],arguments);var e=[new W3DL.Vector4D(this.entries[0][0],this.entries[0][1],this.entries[0][2],this.entries[0][3]),new W3DL.Vector4D(this.entries[1][0],this.entries[1][1],this.entries[1][2],this.entries[1][3]),new W3DL.Vector4D(this.entries[2][0],this.entries[2][1],this.entries[2][2],this.entries[2][3]),new W3DL.Vector4D(this.entries[3][0],this.entries[3][1],this.entries[3][2],this.entries[3][3])];return new W3DL.Vector4D(e[0].dot(t),e[1].dot(t),e[2].dot(t),e[3].dot(t))}},W3DL.Vertex=class{constructor(t,e=new W3DL.ColorRGBA,r=new W3DL.Vector2D,i=new W3DL.Vector4D){W3DL.Utils.ValidateArguments([W3DL.Vector,W3DL.ColorRGBA,W3DL.Vector2D,W3DL.Vector4D],arguments,1),this.position=t,this.color=e,this.texture=r,this.normal=i}get toArray(){return this.position.toArray.concat(this.color.toArray).concat(this.texture.toArray).concat(this.normal.toArray)}get toFloat32Array(){return new Float32Array(this.toArray)}},W3DL.IndexedVertexArray=class{constructor(t=[]){W3DL.Utils.ValidateArguments([Array],arguments,0),this.vertices=t,this.vertexArrayObject=0,this.vertexBufferObject=0}initialize(t){if(W3DL.Utils.ValidateArguments([WebGLRenderingContext],arguments),this.vertices&&this.vertices.length>0){let e=this.vertices[0],r=e.position.toArray.length,i=e.color.toArray.length,n=e.texture.toArray.length,o=e.normal.toArray.length,a=r+i+n+o,s={},l=0;for(let t in e)s[t]=l,l+=e[t].toArray.length;this.vertexArrayObject=t.genVertexArrays(),t.bindVertexArray(vertexArrayObject),this.vertexBufferObject=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,vertexBufferObject),t.bufferData(t.ARRAY_BUFFER,this.vertices.toFloat32Array,t.STATIC_DRAW),t.vertexAttribPointer(0,r,t.FLOAT,t.FALSE,a*Float32Array.BYTES_PER_ELEMENT,s.position*Float32Array.BYTES_PER_ELEMENT),t.enableVertexAttribArray(positionLoc),t.vertexAttribPointer(1,o,t.FLOAT,t.FALSE,a*Float32Array.BYTES_PER_ELEMENT,s.normal*Float32Array.BYTES_PER_ELEMENT),t.enableVertexAttribArray(1),t.vertexAttribPointer(2,i,t.FLOAT,t.FALSE,a*Float32Array.BYTES_PER_ELEMENT,s.color*Float32Array.BYTES_PER_ELEMENT),t.enableVertexAttribArray(2),t.vertexAttribPointer(3,n,t.FLOAT,t.FALSE,a*Float32Array.BYTES_PER_ELEMENT,s.texture*Float32Array.BYTES_PER_ELEMENT),t.enableVertexAttribArray(3),t.enableVertexAttribArray(0),t.bindVertexArray(0)}}},W3DL.ShaderProgram=class{constructor(t,e){W3DL.Utils.ValidateArguments([String,String],arguments),this.vertexShaderCode=t,this.fragmentShaderCode=e,this.id=0}initialize(t){W3DL.Utils.ValidateArguments([WebGLRenderingContext],arguments);let e=t.createShader(t.VERTEX_SHADER);if(t.shaderSource(e,this.vertexShaderCode),t.compileShader(e),!t.getShaderParameter(e,t.COMPILE_STATUS))throw new SyntaxError("Error compiling vertex shader. "+t.getShaderInfoLog(e));let r=t.createShader(t.FRAGMENT_SHADER);if(t.shaderSource(r,this.fragmentShaderCode),t.compileShader(r),!t.getShaderParameter(r,t.COMPILE_STATUS))throw new SyntaxError("Error compiling fragment shader. "+t.getShaderInfoLog(r));if(this.id=t.createProgram(),t.attachShader(this.id,e),t.attachShader(this.id,r),t.linkProgram(this.id),!t.getProgramParameter(this.id,t.LINK_STATUS))throw new Error("Error linking program. "+t.getProgramInfoLog(this.id));if(t.validateProgram(this.id),!t.getProgramParameter(this.id,t.VALIDATE_STATUS))throw new Error("Error validating program. "+t.getProgramInfoLog(this.id));t.detachShader(this.id,e),t.deleteShader(e),t.detachShader(this.id,r),t.deleteShader(r)}bindUniformMatrix(t,e,r){t.useProgram(this.id);let i=t.getUniformLocation(this.id,e);if(!i)return!1;t.uniformMatrix4fv(i,!1,r.toFloat32Array)}bindUniformVector(t,e,r){t.useProgram(this.id);let i=t.getUniformLocation(this.id,e);if(!i)return!1;let n=r.toFloat32Array;return t["uniform"+n.length+"fv"](i,n),!0}bindUniformFloat(t,e,r){t.useProgram(this.id);let i=t.getUniformLocation(this.id,e);return!!i&&(t.uniform1f(i,r),!0)}bindUniformInt(t,e,r){t.useProgram(this.id);let i=t.getUniformLocation(this.id,e);return!!i&&(t.uniform1i(i,r),!0)}},W3DL.Texture2D=class{constructor(t){W3DL.Utils.ValidateArguments([[ImageData,HTMLImageElement,HTMLCanvasElement,HTMLCanvasElement,ImageBitmap]],arguments),this.element=t,this.id=0,this.unit=0}initialize(t,e=0){W3DL.Utils.ValidateArguments([WebGLRenderingContext,Number],arguments,1),this.unit=t.TEXTURE0+(e<t.MAX_COMBINED_TEXTURE_IMAGE_UNITS?e:0);this.id=t.createTexture(),t.bindTexture(t.TEXTURE_2D,this.id),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,this.element),t.bindTexture(t.TEXTURE_2D,null)}},W3DL.Material=class{constructor(t=null,e=new ColorRGBA,r=new ColorRGBA,i=new ColorRGBA,n=1,o=!1){W3DL.Utils.ValidateArguments([W3DL.Texture2D,W3DL.ColorRGBA,W3DL.ColorRGBA,W3DL.ColorRGBA,Number,Boolean],arguments,0),this.texture=t,this.ambient=e,this.diffuse=r,this.specular=i,this.shine=n,this.toon=o}},W3DL.Object3D=class{constructor(t=new W3DL.Vector3D,e=new W3DL.Vector3D(1,1,1),r=new W3DL.Vector3D){W3DL.Utils.ValidateArguments([W3DL.Vector3D,W3DL.Vector3D,W3DL.Vector3D],arguments,0),this.position=t,this.scale=e,this.rotation=r,this.transformation=W3DL.Matrix4.Identity(),this.children=[]}update(t){W3DL.Utils.ValidateArguments([Number],arguments),this.children.forEach(function(e){e.update(t)})}draw(t=W3DL.Matrix4.Identity()){W3DL.Utils.ValidateArguments([W3DL.Matrix4],arguments,0),this.transformation=t.multiply(W3DL.Matrix4.Translation(this.position.x,this.position.y,this.position.z)).multiply(W3DL.Matrix4.RollPitchYawRotation(this.rotation.z,this.rotation.x,this.rotation.y)),this.children.forEach(function(t){t.draw(this.transformation)}),this.transformation=this.transformation.multiply(W3DL.Matrix4.Scale(this.scale.x,this.scale.y,this.scale.z))}rotate(t,e,r,i=!0){W3DL.Utils.ValidateArguments([Number,Number,Number,Boolean],arguments,3),this.rotation.x+=i?t:W3DL.Math.RadianToDegree(t),this.rotation.y+=i?e:W3DL.Math.RadianToDegree(e),this.rotation.z+=i?r:W3DL.Math.RadianToDegree(r)}scale(t,e,r,i=!1){W3DL.Utils.ValidateArguments([Number,Number,Number,Boolean],arguments,3),i&&this.children.forEach(function(n){n.scale(t,e,r,i)}),this.scale.x*=t,this.scale.y*=e,this.scale.z*=r}translate(t,e,r){W3DL.Utils.ValidateArguments([Number,Number,Number],arguments),this.position.x+=t,this.position.y+=e,this.position.z+=r}pitch(t,e=!0){W3DL.Utils.ValidateArguments([Number,Boolean],arguments,1),this.rotation.x+=e?t:W3DL.Math.RadianToDegree(t)}yaw(t,e=!0){W3DL.Utils.ValidateArguments([Number,Boolean],arguments,1),this.rotation.y+=e?t:W3DL.Math.RadianToDegree(t)}roll(t,e=!0){W3DL.Utils.ValidateArguments([Number,Boolean],arguments,1),this.rotation.z+=e?t:W3DL.Math.RadianToDegree(t)}addChild(t){W3DL.Utils.ValidateArguments([W3DL.Object3D],arguments),this.children.push(t)}removeChild(t){W3DL.Utils.ValidateArguments([W3DL.Object3D],arguments);var e=this.children.indexOf(t);e>-1&&this.children.splice(e,1)}},W3DL.GraphicsObject3D=class extends W3DL.Object3D{constructor(t=null,e=new W3DL.Vector3D,r=new W3DL.Vector3D(1,1,1),i=new W3DL.Vector3D){W3DL.Utils.ValidateArguments([W3DL.IndexedVertexArray,W3DL.Vector3D,W3DL.Vector3D,W3DL.Vector3D],arguments,0),super(e,r,i),this.vertices=t,this.shaderProgram=null,this.objectMaterial=null}initialize(t,e,r=!1,i=null,n=!1){W3DL.Utils.ValidateArguments([W3DL.ShaderProgram,W3DL.Material,Boolean,W3DL.IndexedVertexArray,Boolean],arguments,2),r&&(this.children.forEach(function(o){n?o.initialize(t,e,r,i,n):o.initialize(t,e,r)}),this.shaderProgram=t,this.objectMaterial=e,i&&(this.vertices=i))}draw(t,e=W3DL.Matrix4.Identity()){W3DL.Utils.ValidateArguments([WebGLRenderingContext,W3DL.Matrix4],arguments,1),super.draw(e),this.shaderProgram&&(t.useProgram(this.shaderProgram.id),this.shaderProgram.bindUniformMatrix(t,"transform",this.transformation),this.shaderProgram.bindUniformVector(t,"ambient",this.objectMaterial.ambient.toVector4D),this.shaderProgram.bindUniformVector(t,"diffuse",this.objectMaterial.diffuse.toVector4D),this.shaderProgram.bindUniformVector(t,"specular",this.objectMaterial.specular.toVector4D),this.shaderProgram.bindUniformFloat(t,"shine",this.objectMaterial.shine),this.shaderProgram.bindUniformFloat(t,"toon",this.objectMaterial.toon),this.objectMaterial.texture?(t.activeTexture(this.objectMaterial.texture.unit),t.bindTexture(t.TEXTURE_2D,this.objectMaterial.texture.id),this.shaderProgram.bindUniformInt(t,"textureSampler",this.objectMaterial.texture.unit),this.shaderProgram.bindUniformFloat(t,"hasTexture",1)):this.shaderProgram.bindUniformFloat(t,"hasTexture",0),this.vertices&&this.vertices.vertexArrayObject&&(t.bindVertexArray(this.vertices.vertexArrayObject),t.drawArrays(t.TRIANGLES,0,this.vertices.vertices.length),t.bindVertexArray(0)))}setInheritedShader(t){W3DL.Utils.ValidateArguments([W3DL.ShaderProgram],arguments),this.children.forEach(function(e){e.setInheritedShader(t)}),this.shaderProgram=t}setInheritedMaterial(t){W3DL.Utils.ValidateArguments([W3DL.Material],arguments),this.children.forEach(function(e){e.setInheritedMaterial(t)}),this.objectMaterial=t}};
//# sourceMappingURL=w3dl.min.js.map